version: '3.9'

services:
    frontend:
        build:
            context: .
        container_name: bun_frontend
        ports:
            - '5173:5173'
        volumes:
            # Montas solo el código que cambia.
            - ./src:/app/src
            - ./public:/app/public
            - ./tsconfig.json:/app/tsconfig.json
            - ./vite.config.ts:/app/vite.config.ts

            # Volumen persistente para Playwright
            - playwright-cache:/root/.cache/ms-playwright

        command: ['bun', 'run', 'dev', '--host']

    storybook:
        build:
            context: .
        container_name: bun_storybook
        ports:
            - '6006:6006'
        volumes:
            - ./src:/app/src
            - ./.storybook:/app/.storybook
            - ./tsconfig.json:/app/tsconfig.json

            # Volumen persistente para Playwright también para Storybook
            - playwright-cache:/root/.cache/ms-playwright

        command: ['bun', 'run', 'storybook', '--', '--ci', '--disable-telemetry', '--port', '6006']

volumes:
    playwright-cache:
